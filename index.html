<!DOCTYPE html>
<!--
Original obtained from https://github.com/pebble-hacks/js-configure-demo
before modification.  Copyright and license unknown.  

Modifications Copyright 2015 Richard Lee

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html>
  <head>
    <title>OpenHAB for Pebble</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>OpenHAB for Pebble</h1>
      </div>

      <div data-role="content">

	<p>URL (e.g. http://openhab.example.org:8080)</p>
	<div class="ui-body-d">
          <div data-role="fieldcontain">
            <label for="localUrl">Local:</label>
            <input type="text" name="localUrl" required id="localUrl" autocapitalize="off" autocorrect="off"/>
	  </div>

          <div data-role="fieldcontain">
            <label for="remoteUrl">Remote:</label>
            <input type="text" name="remoteUrl" id="remoteUrl" autocapitalize="off" autocorrect="off"/>
          </div>
	  <p>Local URL is for use within the home network.  Remote URL is optional for use over the Internet when away from home.</p>
	</div>

	<p>Authentication (if required)</p>
	<div class="ui-body-d">
          <div data-role="fieldcontain">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" autocapitalize="off"/>
          </div>
	  
          <div data-role="fieldcontain">
            <label for="password">Password:</label>
            <input type="password" name="password" id="password" autocapitalize="off" autocorrect="off"/>
          </div>
	</div>
	
        <div data-role="fieldcontain">
          <label for="sitemap">Sitemap:</label>
          <input type="text" name="sitemap" id="sitemap" autocapitalize="off"/>
        </div>

	<p>If you don't choose a Pebble specific sitemap, and more than one exists for your server, the sitemap selection menu will be displayed.  To bring up the sitemap selection menu on Pebble from any menu screen, long press the SELECT button.</p>

        <div class="ui-body ui-body-b">
          <fieldset class="ui-grid-a">
            <div class="ui-block-a"><button type="submit" data-theme="d" id="b-cancel">Cancel</button></div>
            <div class="ui-block-b"><button type="submit" data-theme="a" id="b-submit">Submit</button></div>
          </fieldset>
	  <br>
	  <p>OpenHAB for Pebble by Richard Lee</p>
	  <p>PebbleKit JS Configuration Utility by Cherie Williams, et al <i>http://github.com/pebble-hacks</i></p>
	  <p>Thanks to Alex Bartis for inspiration <i>http://www.alexbartis.com</i></p>
        </div>
      </div>
    </div>
    <script>
      function saveOptions() {
	var options = {}
	//Add all textual values
	$('textarea, select, [type="hidden"], [type="password"], [type="text"], [type="number"]').each(function(){options[$(this).attr('id')] = $(this).val();})
	//Add all checkbox type values
	$('[type="radio"], [type="checkbox"]').each(function(){options[$(this).attr('id')] = $(this).is(':checked');})
	return options;
      }

      $().ready(function() {
	$("#b-cancel").click(function() {
	  console.log("Cancel");
	  document.location = "pebblejs://close";
	});

	$("#b-submit").click(function() {
	  console.log("Submit");
	  var options = saveOptions();
	  console.log(options);
	  var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
	  console.log("Warping to: " + location);
	  console.log(location);
	  document.location = location;
	});

	//Set form values to whatever is passed in.
	var obj = jQuery.parseJSON(decodeURIComponent(window.location.hash.substring(1)));
	for(key in obj) {
	  $("#"+[key]).val(obj[key]);
          try {
            $("#"+[key]).val(obj[key]).slider("refresh");
          } catch (error) {
          }
	}
      });
    </script>
  </body>
</html>
